curl -o kubectl https://s3.us-east-1.amazonaws.com/amazon-eks/1.30.0/2024-05-17/bin/linux/amd64/kubectl
curl -LO "https://s3.us-west-2.amazonaws.com/amazon-eks/1.30.0/2024-05-17/bin/linux/amd64/kubectl"

chmod +x ./kubectl
mv ./kubectl /usr/local/bin/


curl -o aws-iam-authenticator https://amazon-eks.s3.us-west-2.amazonaws.com/1.30.0/2024-05-17/bin/linux/amd64/aws-iam-authenticator
chmod +x ./aws-iam-authenticator
mv aws-iam-authenticator /usr/local/bin/


aws eks update-kubeconfig --name <clsuter-name> --region us-east-1



grep -A5 -B2 "client.authentication.k8s.io" ~/.kube/config
sed -i 's/client.authentication.k8s.io\/v1alpha1/client.authentication.k8s.io\/v1beta1/g' ~/.kube/config

cat ~/.kube/config | grep client.authentication.k8s


# Remove AWS CLI v1
sudo yum remove -y awscli

# Download and install AWS CLI v2
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
unzip awscliv2.zip
sudo ./aws/install
echo 'export PATH=/usr/local/bin:$PATH' >> ~/.bashrc
source ~/.bashrc


# Verify version
aws --version



# 1) What PSS is enforced on the namespace?
kubectl get ns monitoring -o jsonpath='{.metadata.labels}'; echo

# You want to see:
# "pod-security.kubernetes.io/enforce":"privileged"
# (and optionally audit/warn also set to privileged)

# 2) Did Helm roll back the release?
helm -n monitoring list
helm -n monitoring status kube-prometheus-stack || true

# 3) Recent events â€“ look for "forbidden" / "violates PodSecurity" messages
kubectl -n monitoring get events --sort-by=.metadata.creationTimestamp | tail -n 200

# 4) If any objects still exist, describe node-exporter
kubectl -n monitoring describe ds -l app.kubernetes.io/name=node-exporter || true











