- name: Send TDM Job Completion Email
  shell: bash
  run: |
    echo "[INFO]: Sending simple completion email to users"
    
    chmod +x ./cicd/scripts/send_email.py

    # Define recipient list
    EMAIL_RECIPIENTS="${{ env.DEFAULT_EMAIL }}"
    if [[ -f "usecases/${USECASE_NAME}/admin.ini" ]]; then
        EMAIL_RECIPIENTS_TEMP=$(grep "EMAIL_RECIPIENTS" usecases/${USECASE_NAME}/admin.ini | cut -f 2 -d "=")
        EMAIL_RECIPIENTS="${EMAIL_RECIPIENTS_TEMP},${EMAIL_RECIPIENTS}"
        echo "Usecase specific recipients: ${EMAIL_RECIPIENTS}"
    fi

    # Define simple message
    SUBJECT="TDM Job Execution Completed"
    MESSAGE="Hello Team,\n\nThe TDM data generation job for usecase '${USECASE_NAME}' has been successfully completed.\n\nRegards,\nAutomation Pipeline"

    # Send email
    python3 ./cicd/scripts/send_email.py \
      "${{ env.FROM_ADDRESS }}" \
      "${EMAIL_RECIPIENTS}" \
      "${{ env.SMTP_SERVER }}" \
      "${{ env.SMTP_PORT }}" \
      "${SUBJECT}" \
      "${MESSAGE}"

    echo "[INFO]: Simple completion email sent"
