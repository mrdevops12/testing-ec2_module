kubectl -n win-runner-controller apply -f win-arc-metrics-services.yaml
kubectl -n win-runner-controller describe svc arc-controller-metrics | grep -A2 Endpoints
kubectl -n win-runner-controller describe svc arc-listener-metrics   | grep -A2 Endpoints


kubectl -n monitoring apply -f win-arc-servicemonitors.yaml
kubectl -n monitoring get servicemonitors | grep arc-



kubectl -n win-runner-controller get pod -l app.kubernetes.io/name=gha-rs-controller -o jsonpath='{.items[0].metadata.labels}'
kubectl -n win-runner-controller get pod -l app.kubernetes.io/component=runner-scale-set-listener -o jsonpath='{.items[0].metadata.labels}'

kubectl -n monitoring port-forward svc/kube-prometheus-stack-prometheus 9090:9090


curl -s http://localhost:9090/api/v1/targets | jq -r '
  .data.activeTargets[]
  | select(.labels.namespace=="win-runner-controller")
  | select((.labels.job // "" | tostring) | test("arc-(controller|listener)-metrics"))
  | {job: .labels.job, ns: .labels.namespace, health: .health, url: .scrapeUrl}'



curl -s "http://localhost:9090/api/v1/query?query=sum(gha_desired_runners{namespace=\"win-runner-controller\"})"
curl -s "http://localhost:9090/api/v1/query?query=sum(gha_registered_runners{namespace=\"win-runner-controller\"})"
curl -s "http://localhost:9090/api/v1/query?query=count(gha_controller_running_listeners{namespace=\"win-runner-controller\"})"

/^(runner-set|win-runner-set)$/






kubectl -n monitoring get servicemonitors | grep -E 'arc-(controller|listener)-metrics'

